#!/bin/bash

# Script para substituir todas as referÃªncias ao servidor 193.203.182.22 por 10.102.0.103

echo "ğŸ”„ Substituindo referÃªncias ao servidor..."
echo "   De: 193.203.182.22"
echo "   Para: 10.102.0.103"
echo ""

# Contar arquivos que serÃ£o modificados
COUNT=$(grep -r "193\.203\.182\.22" --include="*.js" --include="*.jsx" --include="*.php" --include="*.sh" --include="*.md" --include="*.py" . 2>/dev/null | grep -v node_modules | grep -v vendor | grep -v ".git" | wc -l)

echo "ğŸ“Š Encontrados aproximadamente $COUNT arquivos com referÃªncias"
echo ""

# Fazer backup
BACKUP_DIR="backups/substituicao_servidor_$(date +%Y%m%d_%H%M%S)"
mkdir -p "$BACKUP_DIR"
echo "ğŸ’¾ Criando backup em: $BACKUP_DIR"
echo ""

# Substituir em arquivos JavaScript/JSX
echo "ğŸ“ Substituindo em arquivos .js e .jsx..."
find . -type f \( -name "*.js" -o -name "*.jsx" \) ! -path "*/node_modules/*" ! -path "*/.git/*" -exec sed -i.bak "s/193\.203\.182\.22/10.102.0.103/g" {} \; 2>/dev/null
echo "   âœ… Arquivos .js/.jsx atualizados"

# Substituir em arquivos PHP
echo "ğŸ“ Substituindo em arquivos .php..."
find . -type f -name "*.php" ! -path "*/vendor/*" ! -path "*/.git/*" -exec sed -i.bak "s/193\.203\.182\.22/10.102.0.103/g" {} \; 2>/dev/null
echo "   âœ… Arquivos .php atualizados"

# Substituir em arquivos Shell
echo "ğŸ“ Substituindo em arquivos .sh..."
find . -type f -name "*.sh" ! -path "*/.git/*" -exec sed -i.bak "s/193\.203\.182\.22/10.102.0.103/g" {} \; 2>/dev/null
echo "   âœ… Arquivos .sh atualizados"

# Substituir em arquivos Markdown
echo "ğŸ“ Substituindo em arquivos .md..."
find . -type f -name "*.md" ! -path "*/.git/*" -exec sed -i.bak "s/193\.203\.182\.22/10.102.0.103/g" {} \; 2>/dev/null
echo "   âœ… Arquivos .md atualizados"

# Substituir em arquivos Python
echo "ğŸ“ Substituindo em arquivos .py..."
find . -type f -name "*.py" ! -path "*/.git/*" ! -path "*/venv/*" -exec sed -i.bak "s/193\.203\.182\.22/10.102.0.103/g" {} \; 2>/dev/null
echo "   âœ… Arquivos .py atualizados"

# Mover backups
echo ""
echo "ğŸ“¦ Movendo backups para: $BACKUP_DIR"
find . -name "*.bak" -exec mv {} "$BACKUP_DIR/" \; 2>/dev/null
echo "   âœ… Backups movidos"

# Verificar se ainda hÃ¡ referÃªncias
REMAINING=$(grep -r "193\.203\.182\.22" --include="*.js" --include="*.jsx" --include="*.php" --include="*.sh" --include="*.md" --include="*.py" . 2>/dev/null | grep -v node_modules | grep -v vendor | grep -v ".git" | grep -v "$BACKUP_DIR" | wc -l)

echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
if [ "$REMAINING" -eq 0 ]; then
    echo "âœ… SubstituiÃ§Ã£o concluÃ­da! Nenhuma referÃªncia restante."
else
    echo "âš ï¸  Ainda restam $REMAINING referÃªncias (podem ser em comentÃ¡rios ou strings especÃ­ficas)"
    echo "   Verifique manualmente se necessÃ¡rio"
fi
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

